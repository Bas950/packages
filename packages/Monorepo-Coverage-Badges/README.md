<h1 align="center">
	Monorepo-Coverage-Badges
</h1>
<div align="center">
	<a href="https://www.npmjs.com/package/monorepo-coverage-badges">
		<img src="https://img.shields.io/npm/v/monorepo-coverage-badges.svg?logo=npm" alt="NPM Version"/>
	</a>
	<a href="https://github.com/Bas950/packages/actions/workflows/CI.yml">
		<img src="https://img.shields.io/github/actions/workflow/status/Bas950/packages/CI.yml?label=Test%20Package&logo=github" alt="CI Status"/>
	</a>
	<a href="https://github.com/Bas950/packages/tree/main/packages/Monorepo-Coverage-Badges"">
		<img src="https://img.shields.io/badge/coverage-100%25-success.svg?placeholder=$coverage-url$&logo=vitest&style=flat" alt="Coverage"/>
	</a>
</div>
<p align="center">
  Generate coverage badges for monorepos
<p>
<details align="center">
	<summary>Table of Contents</summary>
	<a href="#requirements">Requirements</a><br/>
	<a href="#installation">Installation</a><br/>
	<a href="#usage">Usage</a><br/>
	<a href="#configuration">Configuration</a><br/>
	<a href="#license">License</a><br/>
</details>
<br/>

<!-- Requirements -->
<h2 align="center">
	Requirements
</h2>
<p align="center">
	You need to have a coverage report generated by your test runner
	<br/>
	<i>
		You can use any test runner, as long as it generates a coverage report
	</i>
	<br/>
</p>
<h3 align="center">
	Examples
</h3>
<p align="center">
	To generate a coverage report with <a href="https://vitest.dev/">Vitest</a>, you can use the <code>--coverage</code> flag.
	<br/>
	And set the <code>coverage.reporter</code> to include <code>"json-summary"</code> in your <code>vitest.config.ts</code> file.
	<br/>
	<br/>
	To generate a coverage report with <a href="https://jestjs.io/">Jest</a>, you can use the <code>--coverage</code> flag.
	<br/>
	And set the <code>"coverageReporters"</code> to include <code>"json-summary"</code> in your <code>jest.config.js</code> file.
	<br/>
</p>

<!-- Installation -->
<h2 align="center">
	Installation
</h2>
<p align="center">
	Install it with your package manager of choice (npm, yarn, pnpm) as a dev dependency
</p>

```bash
# npm
npm install monorepo-coverage-badges -D

# yarn
yarn add monorepo-coverage-badges -D

# pnpm
pnpm i monorepo-coverage-badges -D
```

<div>
	<p align="center">
		Add the identifiers to your README.md file, where you want the badges to be placed, the identifiers are:
	</p>
	<div align="center">
		<code>$coverage$</code> - The coverage badge
		<br/>
		<code>$lines$</code> - The lines badge
		<br/>
		<code>$statements$</code> - The statements badge
		<br/>
		<code>$functions$</code> - The functions badge
		<br/>
		<code>$branches$</code> - The branches badge
	</div>
	<br/>
	<p align="center">
		The indentifiers can be used multiple times in the same file and will be replaced with the correct <a href="https://shields.io/">shields.io</a> badge url.
	</p>
	<br/>
	<p align="center">
		You may also pass a folder path to each identifier, to generate a badge for a specific folder.
		<br/>
		<i>
			You can use any folder path you want, but the path must be relative to the parent folder of the README.md file that contains the identifier.
		</i>
	</p>
	<br/>
	<p align="center">
		For example, if you have a monorepo with the following structure:
	</p>
	<pre>
	monorepo
	├── README.md
	├── packages
	│   ├── package-1
	│   │   ├── README.md
	│   │   └── package.json
	│   └── package-2
	│       ├── README.md
	│       └── package.json
	└── package.json
	</pre>
	<br/>
	<p align="center">
		You can add the following identifiers to your monorepo's README.md file to generate a badge for the whole monorepo:
		<br/>
		<code>$coverage$</code>, <code>$lines$</code>, <code>$statements$</code>, <code>$functions$</code>, <code>$branches$</code>
	</p>
	<br/>
	<p align="center">
		And if you want to show the coverage for a specific package, you can add the following identifiers to your monorepo's README.md file:
		<br/>
		<code>$coverage$/packages/package-1</code>, <code>$lines$/packages/package-1</code>,<br/><code>$statements$/packages/package-1</code>, <code>$functions$/packages/package-1</code>, <code>$branches$/packages/package-1</code>
	</p>
	<br/>
	<p align="center">
		But you can use the normal identifiers in the package's README.md file, and it will generate a badge for the package itself as the path is relative to the parent folder of the README.md file.
	</p>
</div>

<!-- Usage -->
<h2 align="center">
	Usage
</h2>
<p align="center">
	Add it as a script to your monorepo's <code>package.json</code> file (you can name it whatever you want)
	<br/>
	<i>
	Vitest is used as an example, but you can use any test runner, as long as it generates a coverage report
	</i>
	<br/>
	<br/>
	<i>
	You will most likely have test scripts in each package, if you do, just make the test script in the monorepo's <code>package.json</code> file run the test scripts in each package
	</i>
</p>

```json
{
	"scripts": {
		"test": "vitest --run && pnpm badges",
		"test:watch": "vitest --ui --coverage",
		"test:ci": "vitest --run --coverage && pnpm badges:ci",
		"badges": "monorepo-coverage-badges",
		"badges:ci": "monorepo-coverage-badges --ci"
	}
}
```

<p align="center">
	You can also add it to your <code>pre-commit</code> hook, to make sure the badges are always up to date.
	<br/>
	<i>
		You can use any hook you want, but the <code>pre-commit</code> hook is recommended
	</i>
</p>

```json
{
	"husky": {
		"hooks": {
			"pre-commit": "pnpm test && pnpm badges"
		}
	}
}
```

<!-- Configuration -->
<h2 align="center">
	Configuration
</h2>
<p align="center">
	You can initialize the configuration file with the <code>--init</code> flag.
	<br/>
	After that, you can edit the <code>monorepo-coverage-badges.config.cjs</code> file.
	<br/>
	<br/>
	You can also use the <code>--config</code> flag to specify a custom configuration file.
</p>
<h3 align="center">
	Options
</h3>
<div align="center">
	<code>silent</code> - <i>boolean</i> - <b>default: false</b>
	<br/>
	<p>Disables all WARN and INFO messages</p>
	<br/>
	<code>coverageFiles</code> - <i>string</i> - <b>default: "**/coverage-summary.json"</b>
	<br/>
	<p>Glob pattern to find the coverage files</p>
	<br/>
	<code>mdFiles</code> - <i>object</i> - <b>default: { "**/*.md": ... }</b>
	<br/>
	<p>Object with glob patterns as keys and the values are explained further below</p>
	<br/>
	<code>mdFiles[].coverage</code> - <i>object</i> - <b>default: { label: "coverage", ...DefaultBadge}</b>
	<br/>
	<p>
		Object with the options for the coverage badge, the DefaultBadge options are explained further below
		<br/>
		<code>label</code> is the text that shows inside of the badge
	</p>
	<br/>
	<code>mdFiles[].statements</code> - <i>object</i> - <b>default: { label: "statements", ...DefaultBadge}</b>
	<br/>
	<p>
		Object with the options for the statements badge, the DefaultBadge options are explained further below
		<br/>
		<code>label</code> is the text that shows inside of the badge
	</p>
	<br/>
	<code>mdFiles[].branches</code> - <i>object</i> - <b>default: { label: "branches", ...DefaultBadge}</b>
	<br/>
	<p>
		Object with the options for the branches badge, the DefaultBadge options are explained further below
		<br/>
		<code>label</code> is the text that shows inside of the badge
	</p>
	<br/>
	<code>mdFiles[].functions</code> - <i>object</i> - <b>default: { label: "functions", ...DefaultBadge}</b>
	<br/>
	<p>
		Object with the options for the functions badge, the DefaultBadge options are explained further below
		<br/>
		<code>label</code> is the text that shows inside of the badge
	</p>
	<br/>
	<code>mdFiles[].lines</code> - <i>object</i> - <b>default: { label: "lines", ...DefaultBadge}</b>
	<br/>
	<p>
		Object with the options for the lines badge, the DefaultBadge options are explained further below
		<br/>
		<code>label</code> is the text that shows inside of the badge
	</p>
	<br/>
	<code>DefaultBadge</code> - <i>object</i> - <b>default: { style: "flat", uncoveredText: "unknown", logo: undefined, color: BadgeColor }</b>
	<br/>
	<p>
		Object with the default options for the badges, the BadgeColor options are explained further below
		<br/>
		<code>style</code> is the style of the badge, you can use any style from <a href="https://shields.io/#styles">shields.io</a>
		<br/>
		<code>uncoveredText</code> is the text that shows inside of the badge when the coverage is unknown
		<br/>
		<code>logo</code> is the logo that shows inside of the badge, you can use any logo from <a href="https://simpleicons.org/">simpleicons.org</a>
	</p>
	<br/>
	<code>BadgeColor</code> - <i>object</i> - <b>default: { "<80": "critical", "<90": "important", ">=90": "success", uncovered: "informational" }</b>
  <br/>
  <p>
    Object with the colors for the badges, the keys are the thresholds and the values are the colors, you can use any color from <a href="https://shields.io/#colors">shields.io</a>
    <br/>
    <code>uncovered</code> is the color that shows inside of the badge when the coverage is unknown
    <br/>
    <br/>
    You can use the following operators in the keys of the object:
    <br/>
    <code>==</code> - equal
    <br/>
    <code>!=</code> - not equal
    <br/>
    <code>&lt;</code> - less than
    <br/>
    <code>&gt;</code> - greater than
    <br/>
    <code>&lt;=</code> - less than or equal
    <br/>
    <code>&gt;=</code> - greater than or equal
  </p>
</div>

<!-- License -->
<h2 align="center">
	License
</h2>
<p align="center">
	<a href="https://www.mozilla.org/en-US/MPL/2.0/">
		Mozilla Public License 2.0
	</a>
</p>
